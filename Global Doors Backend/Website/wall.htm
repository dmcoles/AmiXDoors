<!DOCTYPE HTML>
<html>
<head>
 <meta http-equiv="Content-Type" content="text/html;charset=utf-8"> 

 <style type="text/css"></style>
<style>@font-face {
  font-family: 'TopazNew';
  src: url('topaz/TopazPlus_a500_v1.0.eot'); /* IE9 Compat Modes */
  src: url('topaz/TopazPlus_a500_v1.0.eot?#iefix') format('embedded-opentype'), /* IE6-IE8 */
       url('topaz/TopazPlus_a500_v1.0-webfont.woff2') format('woff2'), /* Super Modern Browsers */
       url('topaz/topazplus_a500_v1.0-webfont.woff') format('woff'), /* Pretty Modern Browsers */
       url('topaz/TopazPlus_a500_v1.0.ttf')  format('truetype'), /* Safari, Android, iOS */
       url('topaz/TopazPlus_a500_v1.0.svg#svgFontName') format('svg'); /* Legacy iOS */
}
</style>
</head>
<body vlink="#00eeee" text="#ffffff" link="#00ffff" bgcolor="#000000">
<pre style="font-family: 'TopazNew', Fallback, monospace;"><div id="callsMain" style="display: none"><div style="float: left">  <font color="#ff00ff">    ___   ___________________________________   ___   __________________</font>
  <font color="#ff00ff">   /  /\ / _   /  ___/__   __/  ___/ _   /  /\ /  /\ /  ___/ _  _/  ___/\</font>
  <font color="#ff00ff">  /  /_//     /\__  /\_/  /\/  /\_/     /  /_//  /_//  ___/     )\__  /\/</font>
  <font color="#ff00ff"> /_____/__/__/_____/ //__/ /_____/__/__/_____/_____/_____/__/__/_____/ /</font>
  <font color="#ff00ff"> \_____\__\__\_____\/ \__\/\_____\__\__\_____\_____\_____\__\__\_____\/</font><font color="#0000ff">SdN</font>
  <font color="#ffff00">             GLOBAL LASTCALLERS! - (C) REbEL/qUARTEX                     </font>
  <font color="#00ffff">USERNAME           BBS                   DATE  TIME ON BBS ACTIONS    UPL DWNL</font>
  <font color="#0000ff">------------------v---------------------v-----v-----------v----------v----v----</font>
<div id="callsbody"></div>  <font color="#0000ff">------------------^---------------------^-----^-----------^----------^----^----</font>
  <font color="#ffff00">[</font><font color="#00ffff">D</font><font color="#ffff00">]</font><font color="#ff00ff">OWNLOAD</font>   <font color="#ffff00">[</font><font color="#00ffff">d</font><font color="#ffff00">]</font><font color="#ff00ff">OWNLOAD FAIL</font>  <font color="#ffff00">[</font><font color="#00ffff">o</font><font color="#ffff00">]</font><font color="#ff00ff">PERATOR PAGED!</font>  <font color="#ffff00">[</font><font color="#00ffff">F</font><font color="#ffff00">]</font><font color="#ff00ff">ILE SCAN</font>   <font color="#ffff00">[</font><font color="#00ffff">A</font><font color="#ffff00">]</font><font color="#ff00ff">CCOUNT EDIT!</font>
  <font color="#ffff00">[</font><font color="#00ffff">U</font><font color="#ffff00">]</font><font color="#ff00ff">PLOAD</font>     <font color="#ffff00">[</font><font color="#00ffff">u</font><font color="#ffff00">]</font><font color="#ff00ff">PLOAD FAIL</font>    <font color="#ffff00">[</font><font color="#00ffff">O</font><font color="#ffff00">]</font><font color="#ff00ff">PERATOR CHAT !</font>  <font color="#ffff00">[</font><font color="#00ffff">H</font><font color="#ffff00">]</font><font color="#ff00ff">ACK TRY!</font>   <font color="#ffff00">[</font><font color="#00ffff">L</font><font color="#ffff00">]</font><font color="#ff00ff">OST CARRIER!</font>
  <font color="#ffff00">[</font><font color="#00ffff">*</font><font color="#ffff00">]</font><font color="#ff00ff">NEW-USER</font>  <font color="#ffff00">[</font><font color="#00ffff">B</font><font color="#ffff00">]</font><font color="#ff00ff">ULLETINS</font>      <font color="#ffff00">[</font><font color="#00ffff">E</font><font color="#ffff00">]</font><font color="#ff00ff">X. RESTR. FILE</font>
  <font color="#0000ff">-------------------------------------------------------------------------------</font>
<div id="status1body"></div><div id="status2body"></div><div id="recordsbody"></div>  <font color="#0000ff">-------------------------------------------------------------------------------</font>
<div id="callsmobileentry">
<input style="margin:0 10px 0 0" onclick="prevpage()" type="button" value="Page back"><span /><input style="margin:0 10px 0 0" onclick="nextpage()" type="button" value="Page forward">
</div></div></div><div id="wallMain" style=""><div style="float: left"><div ><font color="#ffff00">         __</font>
<font color="#0000ff">.- - ---</font><font color="#ffff00">_\/_</font><font color="#0000ff">--÷<font color="#00ff00">G</font>÷<font color="#00ff00">L</font>÷<font color="#00ff00">O</font>÷<font color="#00ff00">B</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">L</font>÷--÷<font color="#00ff00">T</font>÷<font color="#00ff00">H</font>÷<font color="#00ff00">E</font>÷<font color="#00ff00">R</font>÷<font color="#00ff00">M</font>÷<font color="#00ff00">O</font>÷<font color="#00ff00">N</font>÷<font color="#00ff00">U</font>÷<font color="#00ff00">C</font>÷<font color="#00ff00">L</font>÷<font color="#00ff00">E</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">R</font>÷--÷<font color="#00ff00">W</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">L</font>÷<font color="#00ff00">L</font>÷-- --- ----.</font>
<font color="#0000ff">!</font><font color="#00ffff">cOMMENt</font><font color="#ffff00">\/\/</font>                                                        <font color="#00ffff">hANDLE</font><font color="#0000ff">¡</font><font color="#00ffff">bBS</font><font color="#0000ff">!</font>
<font color="#0000ff">¦------- -  -  - --- - --- --------------------- ------------ ------------÷---¦</font>
<div id="wallbody"><font color="#0000ff">¦</font>                                                                -        <font color="#0000ff">¦</font>   <font color="#0000ff">¦</font></div><div><font color="#0000ff">`----[</font><font color="#00ff00">REbEL/QTX</font><font color="#0000ff">]-----  - ---  ------------------------ -  ---- ---[</font><font color="#00ff00">oRdYNe</font><font color="#0000ff">]- --'</font></div>
<div style="display: none" id="bbsList"><font color="#0000ff">.------- -  -  - --- - --- ----------------------- ---------- ----------------.</font><div id="bbsListItems"></div><font color="#0000ff">`----- ----- - --------- ------------------------------- -- ---------------- -'</font></div><br/></div><div id="asciiEntryText"><div><font color="#dddddd">C to Comment, K to hide/show BBS List, Cursor keys to move back and forward through the pages</font></div>
<div style="display: none" id="enterMsgPrompt"><br/>Enter your message (max 56 chars): <span id="msgText"></span><span id="cursor1" style="background-color: #FFFFFF"> </span></div>
<div style="display: none" id="enterHandlePrompt">Enter your handle (max 12 chars): <span id="handleText"></span><span id="cursor2" style="background-color: #FFFFFF"> </span></div></div>
<div id="wallmobileentry"><div>Enter your message (max 56 chars): <input id="mobilemsgtxt" oninput="updateInput()" style="width:35%" maxlength="56" type="text" ></div>
<div>Enter your handle (max 12 chars): <input id="mobilehandle" style="width:35%" oninput="updateInput()" maxlength="12" type="text" ></div>
<div>Choose colour: <select id="mobilecolour">
  <option value="1">Red</option>
  <option value="2">Green</option>
  <option value="3">Yellow</option>
  <option value="4">Dark Blue</option>
  <option value="5">Purple</option>
  <option value="6">Cyan</option>
  <option value="7">White</option>
</select>
</div>
<input style="margin:0 10px 0 0" onclick="prevpage()" type="button" value="Page back"><span/><input style="margin:0 10px 0 0" onclick="nextpage()" type="button" value="Page forward"><input style="margin:0 10px 0 0" onclick="showHideKey()" type="button" value="Show/Hide BBS Key"><input id="mobileSubmit" onclick="sendmobilemsg()" type="button" value="Post comment">
</div>

<div style="display: none" id="selectColour">
<font color="#0000ff">.-[» <font color="#00ffff">cHOOSE yOUR cOLOUR</font> «]----- -- ------ --------------------- -  - ---------.<font color="#0000ff">
<font color="#0000ff">¦    <font color="#ffffff">[W]HITE </font>- <font color="#ff0000">[R]ED </font>- <font color="#ffff00">[Y]ELLOW </font>- <font color="#0000ff">[D]ARKBLUE </font>- <font color="#ff00ff">[P]URPLE </font>- <font color="#00ffff">[C]YAN </font>- <font color="#00ff00">[G]REEN </font>   ¦</font>
<font color="#0000ff">`----------- -- ----- - --    - -- --  ---- - -----        - -- -------- -- --'</font>
</div>
</div></div><div style="margin-left: 75em; font: 10px TopazNew" ><font color="#ffffff"> 
<button onclick="showWallItems()">Wall</button><button onclick="showCallItems()">Callers List</button><select onchange="showCallItems()" name='Timezone' id='tzone'>
<option value=''>No Timezone Adjustment</option>
<option selected="selected" value='UTC'>Coordinated Universal Time</option>
<option value='GMT Standard Time'>GMT Standard Time</option>
<option value='W. Europe Standard Time'>W. Europe Standard Time</option>
</select><select onchange="getCallStats()" name='Statistics' id='stattype'>
<option value='0'>Weekly Top Uploaders</option>
<option value='1'>Monthly Top Uploaders</option>
<option value='2'>Weekly Top BBS Uploads</option>
<option value='3'>Monthly Top BBS Uploads</option>
<option value='8'>Weekly Top Downloaders</option>
<option value='9'>Monthly Top Downloaders</option>
<option value='10'>Weekly Top BBS Downloads</option>
<option value='11'>Monthly Top BBS Downloads</option>
<option value='4'>Weekly Top Callers</option>
<option value='5'>Monthly Top Callers</option>
<option value='6'>Weekly Top BBS Calls</option>
<option value='7'>Monthly Top BBS Calls</option>
<option value='12'>Weekly Top User CPS</option>
<option value='13'>Monthly Top User CPS</option>
<option value='14'>Weekly Top BBS CPS</option>
<option value='15'>Monthly Top BBS CPS</option>
</select>
<div style="font-family: 'TopazNew', Fallback, monospace;" id = "callstats"><font color="#0000ff">

    .- -- -------÷<font color="#00ff00">G</font>÷<font color="#00ff00">L</font>÷<font color="#00ff00">O</font>÷<font color="#00ff00">B</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">L</font>÷--÷<font color="#00ff00">L</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">S</font>÷<font color="#00ff00">T</font>÷<font color="#00ff00">C</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">L</font>÷<font color="#00ff00">L</font>÷<font color="#00ff00">E</font>÷<font color="#00ff00">R</font>÷<font color="#00ff00">S</font>÷÷--÷<font color="#00ff00">S</font>÷<font color="#00ff00">T</font>÷<font color="#00ff00">A</font>÷<font color="#00ff00">T</font>÷<font color="#00ff00">S</font>÷-------- -- -.
    !       ¡                                             ¦             <font color="#00ff00"><span id="dayText">         </span></font> !
    !   <font color="#00ff00">Pos</font> ¡ <font color="#ffff00"><span id="statshdr">                                           </span></font> ¦ <font color="#fffff"><span id="amountTxt">CPS        </span></font>           !
    ¦-------÷-------------- -  -  - --- - -÷- ------------÷------ ---------- -----÷<div id="statsbody">    ¦       !                                             ¦                       ¦</div>    ¦       !                                             ¦                       ¦
    `-----------[<font color="#00ff00">REbEL/QTX</font>]-- -  ----------- ------- ---- ---[<font color="#00ff00">oRdYNe</font>]- -----------'


</font></div>
<font color="#aaaaaa">--------------------------------- Advertisement Break ---------------------------------</font>

<div id = "bbsadtxt"></div>

<font color="#aaaaaa">--------------------------------- Advertisement Break ---------------------------------</font></font>



<font color="#aaaaaa"><a id="dizheader">---------------------------------------------------------------------------------------</a></font>

<div id = "filediztxt">
</div>
<font color="#aaaaaa"><a id="dizfooter">---------------------------------------------------------------------------------------</a></font>

</div>



</pre>
<script>
      function is_touch_device() {
        return (('ontouchstart' in window) || (navigator.MaxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0));
      }

      function callsprevpage() {
        page++
        getCallItems()
      }

      function callsnextpage() {
        page--
        if (page<1) { page = 1 }
        getCallItems()
      }

      function keyPressHandler(event) {
        if (showingWall) {
          wallkeyPressHandler(event)
        } else {
          callskeyPressHandler(event)
        }
        
      }
       

      function callskeyPressHandler(event) {
          if (event.altKey || event.ctrlKey) return          
          
        if(event.key == "b"  || event.keyCode == 38) {
                callsprevpage()
				event.preventDefault()
        }
        else if(event.key == "f" || event.keyCode == 40) {
                callsnextpage()
				event.preventDefault()
        }
      }


      function getCallStats() {   
        requeststats.open('GET', 'http://scenewall.bbs.io:1541/GlobalLastCallers/api/GlobalLastCallers/Stats?StatType='+document.getElementById('stattype').value, true);
         // Send request
         requeststats.send();
       }


       function getCallItems() {
        var tz=document.getElementById("tzone").value
		
        var start = ((page - 1) * 30) + 1
        requestcalls.open('GET', 'http://scenewall.bbs.io:1541/GlobalLastCallers/api/GlobalLastCallers/?tzname='+tz.replace('/ /g','+')+'&count=30&start=' + start, true);
         // Send request
         requestcalls.send();
       }

       function getBBSad() {
   
         requestBBSAd.open('GET', 'http://scenewall.bbs.io:1541/GlobalWall/api/BBSAd/', true);
         // Send request
         requestBBSAd.send();
       }
       
       function getDailyDiz() {
   
         requestDailyDiz.open('GET', 'http://scenewall.bbs.io:1541/GlobalWall/api/DailyFileDiz/', true);
         // Send request
         requestDailyDiz.send();
       }

       function postWallMessage(comment,userName,colour) {
        request2.open('POST', 'http://scenewall.bbs.io:1541/GlobalWall/api/WallItems/', true);
            request2.setRequestHeader("Content-type", "application/json");

            switch (colour) {
              case 1:
                comment = "\33[31m"+comment
                break
              case 2:
                comment = "\33[32m"+comment
                break
              case 3:
                comment = "\33[33m"+comment
                break
              case 4:
                comment = "\33[34m"+comment
                break
              case 5:
                comment = "\33[35m"+comment
                break
              case 6:
                comment = "\33[36m"+comment
                break
              case 7:
                comment = "\33[37m"+comment
                break
            }

            comment = clean(comment)
            userName = clean(userName)

        data = {"userName": userName,
                "source": 'Web Browser Interface',
                "comment": comment,
                "bbsshortcode": 'WWW'}

        // Send request
        request2.send(JSON.stringify(data));
       }

       function bbsAdRead() {
        if (requestBBSAd.status >= 200 && requestBBSAd.status < 400) {
          var data = JSON.parse(this.response);
          
          var adlines = data.bbsAdText.split('\n')

          var maxLen=0
          for (n=0; n<adlines.length; n++) {
            maxLen=Math.max(maxLen,adlines[n].length)
          }
          
          var p=((88-maxLen)/2)
          
          for (n=0; n<adlines.length; n++) {
            adlines[n]=' '.repeat(p)+adlines[n]
          }
         
          document.getElementById("bbsadtxt").innerHTML=adlines.join('\n')
        } else {
          console.log("error reading bbs add")
        }
        
       }
       
       function dailyDizRead() {
        if (requestDailyDiz.status >= 200 && requestDailyDiz.status < 400) {
          var data = JSON.parse(this.response);
		  
		  //cyan blue green yellow whote
		  var fname = data.fileDizText.substring(0,13)
		  var f = data.fileDizText.substring(13,14)
		  var n =14
		  var fsize = ''
		  while (data.fileDizText[n]==' ') {
			fsize = fsize+data.fileDizText[n]
			n++
		  }
		  
		  while (data.fileDizText[n]!=' ') {
			fsize = fsize+data.fileDizText[n]
			n++
		  }

		  var fdate = ''
		  while ((data.fileDizText[n]==' ') || (data.fileDizText[n]=='-') || (data.fileDizText[n]>='0' && data.fileDizText[n]<='9')) {
			fdate = fdate+data.fileDizText[n]
			n++
		  }
		  
      var dizLines = data.fileDizText.substring(n).split('\n')
      var maxLen=0
      for (n=0; n<dizLines.length; n++) {
        maxLen=Math.max(maxLen,dizLines[n].length)
      }
      
      var p=88-((88-maxLen)/2)
      
      for (n=0; n<dizLines.length; n++) {
        dizLines[n]=' '.repeat(p-dizLines[n].length)+dizLines[n]
      }
      
      dizLines[0]=dizLines[0].substring(34)
      
     
		  data.fileDizText = dizLines.join('\n')
		  
          document.getElementById("filediztxt").innerHTML='<font color="#00ffff">'+fname+'</font><font color="#0000ff">'+f+'</font><font color="#00ff00">'+fsize+'</font><font color="#ffff00">'+fdate+'</font>'+data.fileDizText
          document.getElementById("dizheader").innerHTML='---------------------------- DIZ of the day ('+data.fileDizDate+') -----------------------------'
          document.getElementById("dizfooter").innerHTML='---------------------------- DIZ of the day ('+data.fileDizDate+') -----------------------------'
        } else {
          console.log("error reading daily diz")
        }
       }

       function statsitemsRead() {
        if (requeststats.status >= 200 && requeststats.status < 400) {
          var data = JSON.parse(this.response);

          var daytext="Day "+data.currentDay.toString()+"/"+data.dayCount.toString()
          document.getElementById('dayText').innerHTML=daytext.padStart(9)

          var sel = document.getElementById('stattype')
          var text= sel.options[sel.selectedIndex].text.substring(0,43).padEnd(43)

          switch (sel.selectedIndex)
          {
            case 0:
            case 1:
            case 2:
            case 3:
              document.getElementById('amountTxt').innerHTML="Upload (KB)"
              break;
            case 4:
            case 5:
            case 6:
            case 7:
              document.getElementById('amountTxt').innerHTML="Dnload (KB)"
              break;
            case 8:
            case 9:
            case 10:
            case 11:
              document.getElementById('amountTxt').innerHTML="Calls      "
              break;
            case 12:
            case 13:
            case 14:
            case 15:
              document.getElementById('amountTxt').innerHTML="CPS        "
              break;
          }
          
          document.getElementById('statshdr').innerHTML=text

          document.getElementById("statsbody").innerHTML=""
          n=1
          data.stats.forEach(function (statItem) {
            output = '    ¦ <font color="#00ff00">'+n.toString().padStart(4)+'. </font>! <font color="#ffff00">'+statItem.name.substring(0,43).padEnd(43)+' </font>¦ <font color="#ffffff">'+statItem.count.toLocaleString().substring(0,21).padEnd(21)+' </font>¦\n'
            n++
            document.getElementById("statsbody").innerHTML = document.getElementById("statsbody").innerHTML + output
          })
        }
       }

       function callitemsRead() {
        if (requestcalls.status >= 200 && requestcalls.status < 400) {
          var data = JSON.parse(this.response);

          document.getElementById("callsbody").innerHTML=""
          data.calls.forEach(function (callItem) {

		      var upkb = callItem.Upload
			  
			  if ((upkb<0) || (upkb>9999)) {
				upkb =( upkb >> 10) & 0x003fffff
				if (upkb>999) {
				  var i = upkb >> 10
				  var f = ((upkb & 1023) * 10) >> 10
          if (i>9) {
            var ul = ('----' + i +'G')
          } else {
            var ul = ('----' + i + '.'+f+'G')
          }
				} else {
                  var ul = ('----' + upkb+'M')
				}
			} else {
               var ul = ('----' + callItem.Upload)
			}
				  

			var dnkb = callItem.Download
			  
			 if ((dnkb<0) || (dnkb>9999)) {
			  dnkb =( dnkb >> 10) & 0x003fffff
			  if (dnkb>999) {
				 var i = dnkb >> 10
				 var f = ((dnkb & 1023) * 10) >> 10
         if (i>9) {
           var dl = ('----' + i + 'G')
         } else {
           var dl = ('----' + i + '.'+f+'G')
         }
			  } else {
                var dl = ('----' + dnkb+'M')
			  }
			} else {
               var dl = ('----' + callItem.Download)
			}


      if (dl.length>8) { dl = '----LOTS' }
      if (ul.length>8) { ul = '----LOTS' }
      dl = dl.slice(dl.length - 4)
      ul = ul.slice(ul.length - 4)

              output = '  <font color="#00ffff">' + callItem.Username.substring(0,18).padEnd(18) + '</font><font color="#0000ff">:</font><font color="#00ff00">' + callItem.Bbsname.substring(0,21).padEnd(21) + '</font><font color="#0000ff">:</font>' + callItem.Dateon.substring(0, 5) + '<font color="#0000ff">:</font><font color="#00ffff">' + callItem.Timeon + '-' + callItem.Timeoff + '</font><font color="#0000ff">:</font>' + callItem.Actions + '<font color="#0000ff">:</font>' + ul + '<font color="#0000ff">:</font>' + dl + '\n'
              document.getElementById("callsbody").innerHTML = document.getElementById("callsbody").innerHTML + output
          })

          //StringF(writeStr, '[35mSTATUS [32m\l\s[8][35m: [1;33mCALLS [0;34m[[36m\r\s[3][34m] [1;33mTOP-CPS [0;34m[[36m\r\s[5][34m]  [1;33mUL [0;34m[[36m\r\s[7] [1;33mKB[0;34m]  [1;33mDL [0;34m[[36m\r\s[7] [1;33mKB[0;34m]', statdate, statcalls, statcps, statup, statdown)

          output = '  <font color="#ff00ff">STATUS</font> <font color="#00ff00">' + data.previousDayStats.statdate.substring(0,8) + '</font><font color="#ff00ff">:</font><font color="#ffff00"> CALLS</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.previousDayStats.calls.toString().padStart(3) + '</font><font color="#0000ff">]</font> <font color="#ffff00">TOP-CPS</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.previousDayStats.topcps.toString().padStart(5) + '</font><font color="#0000ff">]</font>  <font color="#ffff00">UL</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.previousDayStats.uploads.toString().padStart(7) + ' KB</font><font color="#0000ff">]</font>  <font color="#ffff00">DL</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.previousDayStats.downloads.toString().padStart(7) + ' KB</font><font color="#0000ff">]</font>'
            document.getElementById("status1body").innerHTML = output
            output = '  <font color="#ff00ff">STATUS</font> <font color="#00ff00">' + data.yesterdayStats.statdate.substring(0, 8) + '</font><font color="#ff00ff">:</font><font color="#ffff00"> CALLS</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.yesterdayStats.calls.toString().padStart(3) + '</font><font color="#0000ff">]</font> <font color="#ffff00">TOP-CPS</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.yesterdayStats.topcps.toString().padStart(5) + '</font><font color="#0000ff">]</font>  <font color="#ffff00">UL</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.yesterdayStats.uploads.toString().padStart(7) + ' KB</font><font color="#0000ff">]</font>  <font color="#ffff00">DL</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.yesterdayStats.downloads.toString().padStart(7) + ' KB</font><font color="#0000ff">]</font>'
            document.getElementById("status2body").innerHTML = output

            output = '  <font color="#ff00ff">ALLTIME RECORDS: </font><font color="#ffff00">CALLS</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.records.allcalls.toString().padStart(3) + '</font><font color="#0000ff">]</font> <font color="#ff00ff">MOST CALLED SYSTEM</font> <font color="#0000ff">[</font><font color="#00ffff">' + data.records.calls.toString().padStart(3) + '</font><font color="#0000ff">]</font><font color="#ff00ff">: </font><font color="#00ff00">' + data.records.mostcalled + '</font>'

            document.getElementById("recordsbody").innerHTML = output

        } else {
          console.log('error');
        }
       }

      function wallprevpage() {
        page++
        getWallItems()
      }

      function wallnextpage() {
        page--
        if (page<1) { page = 1 }
        getWallItems()
      }

      function showHideKey() {
        keyVisible = !keyVisible
        if (keyVisible) {
          var element = document.getElementById("bbsList")
          element.style.display = "block"
        } else {
          var element = document.getElementById("bbsList")
          element.style.display = "none"
        }
      }

      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
       }

       function wallkeyPressHandler(event) {
          if (event.altKey || event.ctrlKey) return          
          
          if (msgMode==false) {
            if(event.key == "b"  || event.keyCode == 38) {
                  wallprevpage()
            }
            else if(event.key == "f" || event.keyCode == 40) {
                  wallnextpage()
            }
            else if(event.key == "k") {
              showHideKey()
            }
            else if(event.key == "c") {
              var element = document.getElementById("enterMsgPrompt")
              element.style.display = "block"
              var element = document.getElementById("msgText")
              element.innerHTML=""
              msgMode = true
              handleMode = false
              colourMode = false

              element = document.getElementById("cursor1")
              element.innerHTML=" "
              element = document.getElementById("cursor2")
              element.innerHTML=" "
              inputLine = ''
              msgText = ''
            }
         } else {
            if (handleMode == false) {
              var element = document.getElementById("enterMsgPrompt")
              var element2 = document.getElementById("msgText")
            } else {
              var element = document.getElementById("enterHandlePrompt")
              var element2 = document.getElementById("handleText")
            }

            if (colourMode) {

              var colour = -1

              if (event.key == "w") {
                colour = 7
              } else if (event.key == "r") {
                colour = 1
              } else if (event.key == "y") {
                colour = 3
              } else if (event.key == "d") {
                colour = 4
              } else if (event.key == "p") {
                colour = 5
              } else if (event.key == "c") {
                colour = 6
              } else if (event.key == "g") {
                colour = 2
              }

              if (colour!=-1) {
                element.style.display = "none"
                element = document.getElementById("enterMsgPrompt")
                element.style.display = "none"

                var element = document.getElementById("selectColour")
                element.style.display = "none"

                if (inputLine.length>0 && msgText.length>0) {
                    postWallMessage(msgText,inputLine,colour)
                }
                msgMode = false
                handleMode = false
                colourMode = false
              }

            } else {

              if(event.keyCode == 13) {

                if (inputLine.trim().length == 0) {
                  msgMode = false
                  element = document.getElementById("enterMsgPrompt")
                  element.style.display = "none"
                  element = document.getElementById("enterHandlePrompt")
                  element.style.display = "none"
                } else {

                  
                  if (handleMode) {

                    var element = document.getElementById("selectColour")
                    element.style.display = "block"

                    element = document.getElementById("cursor2")
                    element.innerHTML=""

                    setCookie('handle',inputLine,1000)
                    colourMode = true

                  } else {
                    handleMode = true
                    msgText = inputLine
                    inputLine = getCookie('handle')
                    var element = document.getElementById("enterHandlePrompt")
                    element.style.display = "block"
                    element = document.getElementById("cursor1")
                    element.innerHTML=""
                    element = document.getElementById("cursor2")
                    element.innerHTML=" "
                    element = document.getElementById("handleText")
                    element.innerHTML = inputLine
                  }
                }

              } else if(event.keyCode == 27) {
                msgMode = false
                element = document.getElementById("enterMsgPrompt")
                element.style.display = "none"
                element = document.getElementById("enterHandlePrompt")
                element.style.display = "none"

              } else if (event.keyCode == 8) {
                 if (inputLine.length>0) {
                   inputLine = inputLine.substr(0,inputLine.length-1)
                   element2.innerHTML = inputLine
                 }
              } else if (event.keyCode > 31 && event.keyCode <255 && (event.key.length == 1 || event.keyCode == 32) ) {        
                 if (((handleMode == false) && (inputLine.length<56)) || (inputLine.length<12)) {
				   if (event.keyCode == 32) {
                     inputLine = inputLine.concat(' ')
				   } else {
                     inputLine = inputLine.concat(event.key)
				   }
                   element2.innerHTML = inputLine
                 }
              }
            }
         }
         event.preventDefault()
      }

      function updateInput() {
        var element1 = document.getElementById("mobilehandle")
        var element2 = document.getElementById("mobilemsgtxt")
        var submitButton = document.getElementById("mobileSubmit")

        submitButton.disabled = (element1.value == "" || element2.value == "")
      }

      function sendmobilemsg() {
        console.log("sendmobilemsg")
        var element = document.getElementById("mobilemsgtxt")
        msgText = element.value
        var element = document.getElementById("mobilehandle")
        inputLine = element.value
        console.log("about to set cookie")
        setCookie('handle',inputLine,1000)

        var element = document.getElementById("mobilecolour")
        var colour = parseInt(element.value)
        console.log("colour parsed")

        postWallMessage(msgText,inputLine,colour)
        console.log("message posted")

        var element = document.getElementById("mobilemsgtxt")
        element.value = ""
        var element = document.getElementById("mobilemsgtxt")
        element.focus()
        updateInput()
      }

      function unclean(value) {
            value = value.replace(/&#91;/g,'[');
            value = value.replace(/&#93;/g,']');
            value = value.replace(/&#123;/g,'{');
            value = value.replace(/&#125;/g,'}');
            value = value.replace(/&#44;/g,',');
            value = value.replace(/&#58;/g,':');
            value = value.replace(/&#34;/g,'\"');
            value = value.replace(/&#92;/g,'\\');
            value = value.replace(/</g,'');
            value = value.replace(/>/g,'');
         return value
      }

      function clean(value) {
            var regex = new RegExp('\\[', 'g');
            value = value.replace(regex,'&#91;');
            value = value.replace(/]/g,'&#93;');
            value = value.replace(/{/g,'&#123;');
            value = value.replace(/}/g,'&#125;');
            value = value.replace(/,/g,'&#44;');
            value = value.replace(/:/g,'&#58;');
            value = value.replace(/\"/g,'&#34;');
            value = value.replace(/\\/g,'&#92;');
         return value
      }

      function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }

      function clean2(value) {
            value = value.replace(/>/g,'&gt;');
            value = value.replace(/</g,'&lt;');
         return value
      }

       function wallitemsRead() {
        if (requestwall.status >= 200 && requestwall.status < 400) {
          var data = JSON.parse(this.response);

          bbslist = {}

          document.getElementById("wallbody").innerHTML=""
          data.forEach(  function(wallItem) {
            var comment = unclean(wallItem.comment)

            bbslist[unclean(wallItem.bbsshortcode)] = unclean(wallItem.source)

            var colour = '<font color="#ffffff">';

            if ((comment.indexOf('\33[0m')>=0) || (comment.indexOf('\33[0;0m')>=0)) colour = '<font color="#ffffff">';
            if ((comment.indexOf('\33[31m')>=0) || (comment.indexOf('\33[0;31m')>=0)) colour = '<font color="#ff0000">';
            if ((comment.indexOf('\33[32m')>=0) || (comment.indexOf('\33[0;32m')>=0)) colour = '<font color="#00ff00">';
            if ((comment.indexOf('\33[33m')>=0) || (comment.indexOf('\33[0;33m')>=0)) colour = '<font color="#ffff00">';
            if ((comment.indexOf('\33[34m')>=0) || (comment.indexOf('\33[0;34m')>=0)) colour = '<font color="#0000ff">';
            if ((comment.indexOf('\33[35m')>=0) || (comment.indexOf('\33[0;35m')>=0)) colour = '<font color="#ff00ff">';
            if ((comment.indexOf('\33[36m')>=0) || (comment.indexOf('\33[0;36m')>=0)) colour = '<font color="#00ffff">';
            if ((comment.indexOf('\33[37m')>=0) || (comment.indexOf('\33[0;37m')>=0)) colour = '<font color="#ffffff">';
            
            var regex = new RegExp('\33', 'g');
            comment = comment.replace(regex,'');

            regex = new RegExp('\\[0?;?0m', 'g');
            comment = comment.replace(regex,'');
            regex = new RegExp('\\[0?;?31m', 'g');
            comment = comment.replace(regex,'');
            regex = new RegExp('\\[0?;?32m', 'g');

            comment = comment.replace(regex,'');
            regex = new RegExp('\\[0?;?33m', 'g');
            comment = comment.replace(regex,'');
            regex = new RegExp('\\[0?;?34m', 'g');
            comment = comment.replace(regex,'');
            regex = new RegExp('\\[0?;?35m', 'g');
            comment = comment.replace(regex, '');
            regex = new RegExp('\\[0?;?36m', 'g');
            comment = comment.replace(regex, '');
            regex = new RegExp('\\[0?;?37m', 'g');
            comment = comment.replace(regex, '');
            comment = comment.substring(0, 60)
            while (comment.length<60) {
                comment = comment + " "
            }

            comment = clean2(comment)

            var username = wallItem.userName

            username = unclean(username)

            username = username.substring(0,12)

            while (username.length<12) {
              username = username + " "
            }

            username = clean2(username)
      
            comment = colour + comment + '</font>';
			
			var shortCode = wallItem.bbsshortcode.substring(0,3)
            while (shortCode.length<3) {
              shortCode = shortCode + " "
            }         
			
            output = '<font color="#0000ff">¦</font>'+comment+colour+'-'+username+'<font color="#0000ff">¦</font><font color="#ffffff">'+clean2(shortCode)+'<font color="#0000ff">¦</font>\n';
            document.getElementById("wallbody").innerHTML = document.getElementById("wallbody").innerHTML + output
          })

          var output = ""
          for (var key in bbslist) {
            var value = bbslist[key]

            var regex = new RegExp('\33.*?m', 'g');
            value = value.replace(regex,'').substring(0,65)
            
            while (value.length<65) {
              value = value + " "
            }         
			
			key = key.substring(0,3)
            while (key.length<3) {
              key = key + " "
            }         
            output = output + '<font color="#0000ff">¦    <font color="#ffffff">'+clean2(key)+': '+clean2(value)+'</font>   ¦</font>\n'
          }
          document.getElementById("bbsListItems").innerHTML = output

        } else {
          console.log('error');
        }
       }


       function getWallItems() {
   
         requestwall.open('GET', 'http://scenewall.bbs.io:1541/GlobalWall/api/WallItems/?itemcount=30&pageNum='+page, true);
         // Send request
         requestwall.send();
       }

      function showWallItems() {
        page=1
        showingWall = true        
        getWallItems()
        element = document.getElementById("wallMain")
        element.style.display = ""
        element = document.getElementById("callsMain")
        element.style.display = "none"
      }
      
      function showCallItems() {
        page=1
        showingWall = false
        getCallItems()
        element = document.getElementById("callsMain")
        element.style.display = ""
        element = document.getElementById("wallMain")
        element.style.display = "none"
      }

       document.getElementById("callsbody").innerHTML = '';
       document.getElementById("wallbody").innerHTML = '';

       var keyVisible = false
       var msgMode = false
       var handleMode = false
       var colourMode = false

       var bbslist = {}
       
       var requeststats = new XMLHttpRequest();
         requeststats.onload = statsitemsRead

       var requestcalls = new XMLHttpRequest();
         requestcalls.onload = callitemsRead

       var requestwall = new XMLHttpRequest();
         requestwall.onload = wallitemsRead


       var requestBBSAd = new XMLHttpRequest();
         requestBBSAd.onload = bbsAdRead

       var requestDailyDiz = new XMLHttpRequest();
         requestDailyDiz.onload = dailyDizRead

       var page = 1
       var showingWall = true

       var request2 = new XMLHttpRequest();
       request2.onload = function () {
            getWallItems()
        };

       var inputLine = ''
       var msgText = ''


       var mobileMode = is_touch_device()
 
       if (!mobileMode) {
          document.addEventListener('keydown', keyPressHandler)
       }      

       if (mobileMode) {
          element = document.getElementById("callsmobileentry")
          element.style.display = "block"
       } else {
          element = document.getElementById("callsmobileentry")
          element.style.display = "none"
       }
       
      if (mobileMode) {
          var element = document.getElementById("asciiEntryText")
          element.style.display = "none"
          element = document.getElementById("wallmobileentry")
          element.style.display = "block"
          element = document.getElementById("mobileSubmit")
          element.disabled = true
          var handle = getCookie('handle')
          element = document.getElementById("mobilehandle")
          element.value = handle
          element = document.getElementById("mobilemsgtxt")
          element.value = ""

       } else {
          var element = document.getElementById("asciiEntryText")
          element.style.display = "block"
          element = document.getElementById("wallmobileentry")
          element.style.display = "none"
       }
       
        
       
      var output = '';

      getCallItems()
      showWallItems()
      getBBSad()
      getCallStats()
	  getDailyDiz()
		</script>

</body>
</html>